# ุฎูุงุตู ุจูุจูุฏูุง ู ุชุบุฑุงุช - 2025-11-18

## โ 1. ุญุฐู ฺฏูุชฺฏููุง Orphan ุงุฒ Core

### ูุดฺฉู:
ุงฺฏุฑ ุญุฐู conversation ุฏุฑ Core RAG ูุงูููู ุจุงุดุฏุ ฺฏูุชฺฏููุง orphan ุจุงู ูโูุงููุฏ.

### ุฑุงูโุญู:
```bash
# ุงุฌุฑุง ุฏุณุชูุฑ cleanup
cd /srv/deployment
docker-compose exec backend python manage.py cleanup_orphan_conversations

# ุจุฑุง ูุดุงูุฏู ุจุฏูู ุญุฐู ูุงูุน
docker-compose exec backend python manage.py cleanup_orphan_conversations --dry-run
```

### ูุงู ุงุฌุงุฏ ุดุฏู:
- `/srv/backend/chat/management/commands/cleanup_orphan_conversations.py`

---

## โ 2. ุฑูุน ูุดฺฉู ุงุฑุณุงู ูพุงู ุจุฑุง ฺฉุงุฑุจุฑุงู

### ูุดฺฉู:
```
AttributeError: 'Subscription' object has no attribute 'can_query'
```

### ุฑุงูโุญู:
ูุชุฏ `can_query()` ุจู model `Subscription` ุงุถุงูู ุดุฏ:

```python
def can_query(self):
    """ุจุฑุฑุณ ุงูฺฉู ุขุง ฺฉุงุฑุจุฑ ูโุชูุงูุฏ query ุจูุฑุณุชุฏ"""
    if not self.is_active:
        return False, "ุงุดุชุฑุงฺฉ ุดูุง ูููุถ ุดุฏู ุงุณุช"
    
    return True, "OK"
```

### ูุงู ุชุบุฑ ุงูุชู:
- `/srv/backend/subscriptions/models.py`

### ุชุณุช:
```bash
# ฺฉุงุฑุจุฑุงู ุญุงูุง ูโุชูุงููุฏ ูพุงู ุงุฑุณุงู ฺฉููุฏ
# ุจุง ุดูุงุฑู 09122711309 ุชุณุช ฺฉูุฏ
```

---

## โ 3. ุทุฑุงุญ ูุฌุฏุฏ ุตูุญู ุชูุธูุงุช

### ุชุบุฑุงุช:
- โ ุตูุญู ุชูุธูุงุช ุงุฒ modal ุณุงุฏู ุจู ุตูุญู ฺฉุงูู ุจุง sidebar ุชุจุฏู ุดุฏ
- โ ุฏุณุชูโุจูุฏ ุชูุธูุงุช: ูพุฑููุงูุ ุงุดุชุฑุงฺฉุ ุชูุธูุงุชุ ุงุนูุงูโูุงุ ุงููุชุ ุฑุงูููุง
- โ ููุงุด ุงุทูุงุนุงุช ุงุดุชุฑุงฺฉ ุจุง progress bar
- โ ููุงุด ูพููโูุง ููุฌูุฏ ุจุง ุงูฺฉุงู ุงุฑุชูุง
- โ ุทุฑุงุญ ูุฏุฑู ู responsive

### ูุงูโูุง ุงุฌุงุฏ/ุชุบุฑ ุงูุชู:
- `/srv/frontend/src/components/SettingsPage.tsx` (ุฌุฏุฏ)
- `/srv/frontend/src/components/chat/ChatSidebar.tsx` (ุชุบุฑ import)

### ููุงุด:
- Sidebar ุณูุช ุฑุงุณุช ุจุง ูุณุช ุฏุณุชูโูุง
- ูุญุชูุง ุงุตู ุณูุช ฺูพ
- ุทุฑุงุญ ูุดุงุจู ุชุตูุฑ ููููู ุงุฑุณุงู

---

## โ 4. ูุฏุฑุช Plan ูุง ุฏุฑ Django Admin

### ุชุบุฑุงุช:
- โ ููุงุด ุจูุชุฑ Plan ูุง ุจุง ุณุชููโูุง ุงุถุงู
- โ ุงูฺฉุงู ูุฑุงุด inline (ููุชุ ูุฏุชุ ูุถุนุช)
- โ ููุงุด ูุญุฏูุฏุชโูุง ุงุฒ JSON features
- โ ุฑูฺฏโุจูุฏ ูุถุนุชโูุง
- โ Fieldset ุจุฑุง ุณุงุฒูุงูุฏู ุจูุชุฑ ููุฏูุง

### ุชุบุฑุงุช Subscription Admin:
- โ ููุงุด ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ ุจุง ูุฑูุช ุจูุชุฑ
- โ ููุงุด ุฑูุฒูุง ุจุงููุงูุฏู
- โ Action ูุง ุฌุฏุฏ: ูุนุงูโุณุงุฒุ ูุบูุ ุชูุฏุฏ 30 ุฑูุฒู
- โ ููุชุฑูุง ุจุดุชุฑ
- โ ุงูฺฉุงู ุฌุณุชุฌู ุจุง ุดูุงุฑู ููุจุงู

### ูุงู ุชุบุฑ ุงูุชู:
- `/srv/backend/subscriptions/admin.py`

### ูุญูู ุงุณุชูุงุฏู:
```
1. ุจู Django Admin ุจุฑูุฏ: http://YOUR_IP/admin
2. ุจุฎุด Subscriptions โ Plans
3. ูโุชูุงูุฏ:
   - Plan ุฌุฏุฏ ุงุถุงูู ฺฉูุฏ
   - ููุช ู ูุฏุช ุฑุง ูุณุชูู ุงุฒ ูุณุช ุชุบุฑ ุฏูุฏ
   - features ุฑุง ุจู ุตูุฑุช JSON ูุฑุงุด ฺฉูุฏ
   - Plan ูุง ุฑุง ูุนุงู/ุบุฑูุนุงู ฺฉูุฏ
```

### ูุซุงู JSON ุจุฑุง features:
```json
{
  "max_queries_per_day": 50,
  "max_queries_per_month": 1500,
  "gpt_3_5_access": true,
  "gpt_4_access": false,
  "max_tokens_per_query": 4000,
  "api_access": true
}
```

---

## ๐ ูุถุนุช ููุง

### โ ฺฉุงุฑูุง ุงูุฌุงู ุดุฏู:
1. โ Management command ุจุฑุง ุญุฐู orphan conversations
2. โ ุฑูุน ูุดฺฉู can_query ุฏุฑ Subscription model
3. โ ุทุฑุงุญ ูุฌุฏุฏ ุตูุญู ุชูุธูุงุช ุจุง sidebar
4. โ ุจูุจูุฏ Django Admin ุจุฑุง ูุฏุฑุช Plan ูุง
5. โ ุงุถุงูู ฺฉุฑุฏู action ูุง ููุฏ ุฏุฑ Subscription Admin

### ๐ ฺฉุงุฑูุง ุจุงููุงูุฏู (ุจุฑุง ุขูุฏู):
- [ ] ูพุงุฏูโุณุงุฒ usage tracking ูุงูุน (queries_used_today/month)
- [ ] ุงุชุตุงู ุตูุญู ุชูุธูุงุช ุจู API ุจุฑุง ุฏุฑุงูุช ุงุทูุงุนุงุช ูุงูุน
- [ ] ูพุงุฏูโุณุงุฒ ุชุจโูุง ุงุนูุงูโูุงุ ุงููุชุ ุฑุงูููุง
- [ ] ุณุณุชู ูพุฑุฏุงุฎุช ุจุฑุง ุฎุฑุฏ ุงุดุชุฑุงฺฉ

---

## ๐งช ุชุณุชโูุง

### ุชุณุช 1: ุงุฑุณุงู ูพุงู
```bash
# ุจุง ุดูุงุฑู 09122711309 ูุงฺฏู ฺฉูุฏ
# ฺฉ ูพุงู ุงุฑุณุงู ฺฉูุฏ
# ุจุงุฏ ุจุฏูู ุฎุทุง ฺฉุงุฑ ฺฉูุฏ โ
```

### ุชุณุช 2: ุตูุญู ุชูุธูุงุช
```bash
# ุฑู ุฏฺฉูู ุชูุธูุงุช (ูพุงู sidebar) ฺฉูฺฉ ฺฉูุฏ
# ุตูุญู ุฌุฏุฏ ุจุง sidebar ุจุงุฒ ูโุดูุฏ โ
# ุจู ุชุจโูุง ุฌุงุจุฌุง ุดูุฏ โ
```

### ุชุณุช 3: Django Admin
```bash
# ุจู /admin ุจุฑูุฏ
# Subscriptions โ Plans ุฑุง ุจุงุฒ ฺฉูุฏ
# ููุช ฺฉ plan ุฑุง ุชุบุฑ ุฏูุฏ โ
# Plan ุฌุฏุฏ ุงุถุงูู ฺฉูุฏ โ
```

### ุชุณุช 4: Cleanup Orphans
```bash
cd /srv/deployment
docker-compose exec backend python manage.py cleanup_orphan_conversations --dry-run
# ูุณุช conversation ูุง ฺฉู ุญุฐู ูโุดููุฏ ุฑุง ุจุจูุฏ โ
```

---

## ๐ ูฺฉุงุช ููู

### Plan Features Structure:
```json
{
  "max_queries_per_day": 10,
  "max_queries_per_month": 300,
  "gpt_3_5_access": true,
  "gpt_4_access": false,
  "claude_access": false,
  "max_tokens_per_query": 2000,
  "api_access": false,
  "webhook_access": false
}
```

### Subscription Status:
- `active`: ูุนุงู
- `expired`: ูููุถ ุดุฏู
- `cancelled`: ูุบู ุดุฏู
- `pending`: ุฏุฑ ุงูุชุธุงุฑ

---

**ุชุงุฑุฎ:** 2025-11-18  
**ูุณุฎู:** 2.3
